<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote File Upload to Google Drive</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h1>Remote Upload to Google Drive</h1>
    
    <button id="authorize_button" style="display: none;">Connect to Google Drive</button>
    <button id="signout_button" style="display: none;">Sign Out</button>

    <p>Enter a file URL to upload to Google Drive:</p>
    <input type="text" id="file_url" placeholder="Enter file URL">
    <button id="upload_button" style="display: none;">Upload to Google Drive</button>

    <pre id="content"></pre>

    <script>
        var CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com';
        var API_KEY = 'YOUR_API_KEY'; // Optional if you plan to use it with Google APIs
        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        var SCOPES = 'https://www.googleapis.com/auth/drive.file';

        var authorizeButton = document.getElementById('authorize_button');
        var signoutButton = document.getElementById('signout_button');
        var uploadButton = document.getElementById('upload_button');
        var content = document.getElementById('content');

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(function () {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                authorizeButton.onclick = handleAuthClick;
                signoutButton.onclick = handleSignoutClick;
            }, function (error) {
                content.innerText = JSON.stringify(error, null, 2);
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                authorizeButton.style.display = 'none';
                signoutButton.style.display = 'block';
                uploadButton.style.display = 'block';
            } else {
                authorizeButton.style.display = 'block';
                signoutButton.style.display = 'none';
                uploadButton.style.display = 'none';
            }
        }

        function handleAuthClick(event) {
            gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
        }

        // Download file from URL and upload to Google Drive
        uploadButton.onclick = function () {
            var fileUrl = document.getElementById("file_url").value;
            if (!fileUrl) {
                alert("Please enter a valid file URL.");
                return;
            }
            
            // Fetch the file as a blob from the given URL
            fetch(fileUrl)
                .then(response => response.blob())
                .then(blob => {
                    var metadata = {
                        name: 'uploaded_file_from_url', // File name
                        mimeType: blob.type // File type
                    };

                    var form = new FormData();
                    form.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
                    form.append("file", blob);

                    // Upload the file to Google Drive
                    fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id", {
                        method: "POST",
                        headers: new Headers({ "Authorization": "Bearer " + gapi.auth.getToken().access_token }),
                        body: form
                    })
                    .then(response => response.json())
                    .then(data => {
                        content.innerText = "File uploaded successfully! File ID: " + data.id;
                    })
                    .catch(error => {
                        content.innerText = "Error uploading file: " + JSON.stringify(error, null, 2);
                    });
                })
                .catch(error => {
                    content.innerText = "Error fetching file from URL: " + JSON.stringify(error, null, 2);
                });
        };

        handleClientLoad();
    </script>
</body>
</html>
